{% extends "base.html" %}

{% block title %}{{ entry.entry_date.strftime('%B %d, %Y') }} - View Entry{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">
            {{ entry.entry_date.strftime('%A, %B %d, %Y') }}
        </h1>
        <a href="/entries/new?entry_date={{ entry.entry_date.isoformat() }}" 
           class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
            Edit Entry
        </a>
    </div>
    
    <!-- Summary Panel -->
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <p class="text-gray-600">{{ entry.summary() }}</p>
    </div>
    
    <!-- Auto-collected data -->
    {% if entry.integrations.weather or entry.integrations.activities or entry.integrations.sleep %}
    <div class="bg-blue-50 rounded-xl p-6 mb-6">
        <h2 class="text-lg font-semibold text-blue-800 mb-4">ğŸ“¡ Auto-collected Data</h2>
        <div class="grid md:grid-cols-3 gap-4">
            {% if entry.integrations.weather %}
            <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-medium text-gray-700 mb-2">ğŸŒ¤ï¸ Weather</h3>
                <p class="text-2xl font-bold">{{ entry.integrations.weather.temp_avg_c|round|int }}Â°C</p>
                {% if entry.integrations.weather.description %}
                <p class="text-sm text-gray-600 capitalize">{{ entry.integrations.weather.description }}</p>
                {% endif %}
                <div class="mt-2 text-sm text-gray-500 space-y-1">
                    {% if entry.integrations.weather.temp_high_c and entry.integrations.weather.temp_low_c %}
                    <p>â†‘ {{ entry.integrations.weather.temp_high_c|round|int }}Â°C / â†“ {{ entry.integrations.weather.temp_low_c|round|int }}Â°C</p>
                    {% endif %}
                    {% if entry.integrations.weather.pressure_hpa %}
                    <p>Pressure: <strong>{{ entry.integrations.weather.pressure_hpa|round|int }}</strong> hPa</p>
                    {% endif %}
                    {% if entry.integrations.weather.humidity_percent %}
                    <p>Humidity: {{ entry.integrations.weather.humidity_percent }}%</p>
                    {% endif %}
                    {% if entry.integrations.weather.wind_speed_mph %}
                    <p>Wind: {{ entry.integrations.weather.wind_speed_mph|round(1) }} km/h</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            {% if entry.integrations.activities %}
            <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-medium text-gray-700 mb-2">ğŸš´ Activities</h3>
                {% for activity in entry.integrations.activities %}
                <div class="{% if not loop.first %}mt-3 pt-3 border-t{% endif %}">
                    <p class="font-medium text-gray-800">{{ activity.name or activity.activity_type }}</p>
                    <div class="text-sm text-gray-500 space-y-1 mt-1">
                        <p>
                            <strong>{{ activity.duration_minutes|round|int }}</strong> min
                            {% if activity.distance_km %} Â· <strong>{{ activity.distance_km|round(1) }}</strong> km{% endif %}
                            {% if activity.elevation_gain_m %} Â· <strong>{{ activity.elevation_gain_m|round|int }}</strong>m â†‘{% endif %}
                        </p>
                        {% if activity.average_speed_kmh %}
                        <p>Avg speed: {{ activity.average_speed_kmh|round(1) }} km/h</p>
                        {% endif %}
                        {% if activity.average_heart_rate %}
                        <p>â¤ï¸ {{ activity.average_heart_rate|round|int }} bpm avg{% if activity.max_heart_rate %} / {{ activity.max_heart_rate|round|int }} max{% endif %}</p>
                        {% endif %}
                        {% if activity.average_power_watts %}
                        <p>âš¡ {{ activity.average_power_watts|round|int }}W avg{% if activity.normalized_power_watts %} / {{ activity.normalized_power_watts|round|int }}W NP{% endif %}</p>
                        {% endif %}
                        {% if activity.average_cadence %}
                        <p>Cadence: {{ activity.average_cadence|round|int }} rpm</p>
                        {% endif %}
                        {% if activity.suffer_score %}
                        <p>Relative Effort: {{ activity.suffer_score|round|int }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if entry.integrations.sleep %}
            <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-medium text-gray-700 mb-2">ğŸ˜´ Sleep</h3>
                <p class="text-2xl font-bold">{{ entry.integrations.sleep.sleep_score or 'N/A' }}</p>
                <p class="text-sm text-gray-600">
                    {{ (entry.integrations.sleep.total_sleep_minutes or 0) // 60 }}h 
                    {{ (entry.integrations.sleep.total_sleep_minutes or 0) % 60 }}m total
                </p>
                <div class="mt-2 text-sm text-gray-500 space-y-1">
                    {% if entry.integrations.sleep.deep_sleep_minutes %}
                    <p>ğŸŸ¦ Deep: {{ entry.integrations.sleep.deep_sleep_minutes }} min ({{ ((entry.integrations.sleep.deep_sleep_minutes or 0) / (entry.integrations.sleep.total_sleep_minutes or 1) * 100)|round|int }}%)</p>
                    {% endif %}
                    {% if entry.integrations.sleep.rem_sleep_minutes %}
                    <p>ğŸŸª REM: {{ entry.integrations.sleep.rem_sleep_minutes }} min ({{ ((entry.integrations.sleep.rem_sleep_minutes or 0) / (entry.integrations.sleep.total_sleep_minutes or 1) * 100)|round|int }}%)</p>
                    {% endif %}
                    {% if entry.integrations.sleep.light_sleep_minutes %}
                    <p>ğŸŸ© Light: {{ entry.integrations.sleep.light_sleep_minutes }} min ({{ ((entry.integrations.sleep.light_sleep_minutes or 0) / (entry.integrations.sleep.total_sleep_minutes or 1) * 100)|round|int }}%)</p>
                    {% endif %}
                    {% if entry.integrations.sleep.efficiency_percent %}
                    <p>Efficiency: {{ entry.integrations.sleep.efficiency_percent }}%</p>
                    {% endif %}
                    {% if entry.integrations.sleep.hrv_average %}
                    <p>HRV: <strong>{{ entry.integrations.sleep.hrv_average|round|int }}</strong> ms</p>
                    {% endif %}
                    {% if entry.integrations.sleep.lowest_heart_rate %}
                    <p>â¤ï¸ {{ entry.integrations.sleep.lowest_heart_rate|round|int }} bpm lowest{% if entry.integrations.sleep.average_heart_rate %} / {{ entry.integrations.sleep.average_heart_rate|round|int }} avg{% endif %}</p>
                    {% endif %}
                    {% if entry.integrations.sleep.respiratory_rate %}
                    <p>Breathing: {{ entry.integrations.sleep.respiratory_rate|round(1) }}/min</p>
                    {% endif %}
                    {% if entry.integrations.sleep.bedtime and entry.integrations.sleep.wake_time %}
                    <p class="text-xs text-gray-400 mt-2">
                        ğŸ›ï¸ {{ entry.integrations.sleep.bedtime.strftime('%H:%M') }} â†’ {{ entry.integrations.sleep.wake_time.strftime('%H:%M') }}
                    </p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- Daily Assessment -->
    {% if entry.overall_wellbeing or entry.energy_level or entry.stress_level %}
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ“Š Daily Assessment</h2>
        <div class="grid md:grid-cols-3 gap-6">
            {% if entry.overall_wellbeing %}
            <div class="text-center">
                <div class="text-3xl font-bold text-indigo-600">{{ entry.overall_wellbeing }}/10</div>
                <div class="text-sm text-gray-500">Overall Wellbeing</div>
            </div>
            {% endif %}
            {% if entry.energy_level %}
            <div class="text-center">
                <div class="text-3xl font-bold text-indigo-600">{{ entry.energy_level }}/10</div>
                <div class="text-sm text-gray-500">Energy Level</div>
            </div>
            {% endif %}
            {% if entry.stress_level %}
            <div class="text-center">
                <div class="text-3xl font-bold text-indigo-600">{{ entry.stress_level }}/10</div>
                <div class="text-sm text-gray-500">Stress Level</div>
            </div>
            {% endif %}
        </div>
        {% if entry.general_notes %}
        <div class="mt-4 pt-4 border-t">
            <p class="text-gray-700">{{ entry.general_notes }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Symptoms -->
    {% if entry.symptoms %}
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ¤• Symptoms</h2>
        <div class="space-y-3">
            {% for symptom in entry.symptoms %}
            <div class="flex items-center justify-between p-3 rounded-lg severity-{{ symptom.severity.value }}">
                <div>
                    <span class="font-medium">{{ symptom.display_type }}</span>
                    {% if symptom.display_location %}
                    <span class="text-gray-600">- {{ symptom.display_location }}</span>
                    {% endif %}
                    {% if symptom.notes %}
                    <p class="text-sm text-gray-600">{{ symptom.notes }}</p>
                    {% endif %}
                </div>
                <span class="text-lg font-bold">{{ symptom.severity.value }}/10</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Incidents -->
    {% if entry.incidents %}
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">âš ï¸ Incidents</h2>
        <div class="space-y-3">
            {% for incident in entry.incidents %}
            <div class="p-3 rounded-lg bg-yellow-50 border border-yellow-200">
                <div class="flex justify-between">
                    <span class="font-medium">{{ incident.display_type }}</span>
                    <span class="text-sm text-gray-500">{{ incident.location.value.replace('_', ' ').title() }}</span>
                </div>
                <p class="text-gray-700">{{ incident.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Meals -->
    {% if entry.meals %}
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ½ï¸ Meals & Drinks</h2>
        <div class="space-y-3">
            {% for meal in entry.meals %}
            <div class="p-3 rounded-lg bg-green-50 border border-green-200">
                <div class="flex justify-between items-start">
                    <div>
                        <span class="font-medium capitalize">{{ meal.meal_type.value }}</span>
                        <p class="text-gray-700">{{ meal.description }}</p>
                    </div>
                    <div class="flex space-x-2">
                        {% if meal.contains_alcohol %}
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">ğŸ· {{ meal.alcohol_units }} units</span>
                        {% endif %}
                        {% if meal.contains_caffeine %}
                        <span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded">â˜• Caffeine</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="flex justify-between items-center">
        <a href="/entries/" class="text-gray-500 hover:text-gray-700">â† Back to entries</a>
    </div>
</div>
{% endblock %}
